name: OneFlow Serving

on: [push]
  # pull_request:
  #   # types: [review_requested]
  #   branches:
  #     - "*"
  # workflow_dispatch:
  #   inputs:
  #     placeholder:
  #       description: "placeholder, no effect"
  #       required: false

jobs:
  cancel_previous:
    name: Cancel previous runs
    runs-on: ubuntu-latest
    steps:
      - name: Cancel previous runs of outdated commit
        if: github.ref != 'refs/heads/master'
        uses: styfle/cancel-workflow-action@0.9.0
        with:
          access_token: ${{ github.token }}

  build_oneflow:
    runs-on: self-hosted
    needs: [cancel_previous]
    steps:
      - name: touch a file
        run: touch a.txt

  build_oneflow_backend:
    runs-on: self-hosted
    needs: [build_oneflow]
    steps:
      - name: append a file
        run: |
          ls -alh
          echo "hello" > a.txt

  build_user_image:
    runs-on: self-hosted
    needs: [build_oneflow_backend]
    steps:
      - name: cat a file and append
        runs: |
          ls -alh
          cat a.txt
          echo "asdfasfd" > a.txt
  
  run_test:
    runs-on: self-hosted
    needs: [build_user_image]
    steps:
      - name: cat a file and delete
        runs: |
          ls -alh
          cat a.txt
          rm a.txt
